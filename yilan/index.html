<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Neon Yılan Pro Max</title>
  <style>
    body {
      margin: 0; padding: 0; background-color: #050505; color: white;
      font-family: 'Courier New', Courier, monospace;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100vh; overflow: hidden; touch-action: none;
    }
    #oyunKonteyner { position: relative; border: 4px solid #222; }
    canvas { display: block; background: #000; max-width: 95vw; max-height: 75vh; }
    
    .ekran {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.95); display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 10; text-align: center;
    }
    .renk-secenekleri { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
    .renk-kutusu { width: 50px; height: 50px; border-radius: 50%; cursor: pointer; border: 3px solid #fff; transition: 0.2s; }
    .renk-kutusu:hover { transform: scale(1.1); }
    
    button { background: #00ff00; color: #000; border: none; padding: 15px 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
    .istatistik { margin-top: 10px; font-size: 1.2rem; display: flex; gap: 40px; }
    #hayaletBar { width: 0%; height: 8px; background: #ff00ff; position: absolute; bottom: 0; box-shadow: 0 0 15px #ff00ff; }
  </style>
</head>
<body>

<h1 style="margin: 10px 0;">NEON YILAN: REBORN</h1>

<div id="oyunKonteyner">
  <div id="baslangicEkrani" class="ekran">
    <h2 style="color: #00ff00;">YILAN RENGİNİ SEÇ</h2>
    <div class="renk-secenekleri">
      <div class="renk-kutusu" style="background: #00ff00;" onclick="oyunuBaslat('#00ff00', '#008f00')"></div>
      <div class="renk-kutusu" style="background: #00ffff;" onclick="oyunuBaslat('#00ffff', '#008b8b')"></div>
      <div class="renk-kutusu" style="background: #ff00ff;" onclick="oyunuBaslat('#ff00ff', '#8b008b')"></div>
      <div class="renk-kutusu" style="background: #ffff00;" onclick="oyunuBaslat('#ffff00', '#8b8b00')"></div>
      <div class="renk-kutusu" style="background: #ff4500;" onclick="oyunuBaslat('#ff4500', '#8b2500')"></div>
      <div class="renk-kutusu" style="background: #ffffff;" onclick="oyunuBaslat('#ffffff', '#888888')"></div>
    </div>
    <div id="rekorGosterge" style="color: gold; margin-top: 10px;"></div>
  </div>

  <div id="bitisEkrani" class="ekran" style="display: none;">
    <h2 style="color: #ff0055;">OYUN BİTTİ</h2>
    <p style="font-size: 1.5rem;">Skor: <span id="sonSkor">0</span></p>
    <button onclick="location.reload()">TEKRAR OYNA</button>
  </div>

  <canvas id="oyunAlani" width="600" height="600"></canvas>
  <div id="hayaletBar"></div>
</div>

<div class="istatistik">
  <div>SKOR: <span id="skor">0</span></div>
  <div>REKOR: <span id="rekor">0</span></div>
</div>

<script>
  const canvas = document.getElementById('oyunAlani');
  const ctx = canvas.getContext('2d');
  const kareBoyutu = 20;
  const karoSayisi = canvas.width / kareBoyutu;

  let yilan, yem, engeller, dx, dy, skor, hiz, oyunDongusu;
  let anaRenk, ikincilRenk, hayaletModu, hayaletSure, powerUp;
  let rotationAngle = 0;

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function sesCal(f, t, s) {
    try {
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
      g.gain.setValueAtTime(0.05, audioCtx.currentTime);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + s);
    } catch(e) {}
  }

  let rekor = localStorage.getItem('neonRekorV2') || 0;
  document.getElementById('rekor').innerText = rekor;
  document.getElementById('rekorGosterge').innerText = "EN YÜKSEK SKOR: " + rekor;

  function oyunuBaslat(renk, koyu) {
    anaRenk = renk; ikincilRenk = koyu;
    yilan = [{x: 10, y: 15}, {x: 9, y: 15}, {x: 8, y: 15}];
    dx = 1; dy = 0; skor = 0; hiz = 10;
    engeller = []; powerUp = null; hayaletModu = false; hayaletSure = 0;
    document.getElementById('baslangicEkrani').style.display = 'none';
    rastgeleYem();
    baslatDongu();
    if (audioCtx.state === 'suspended') audioCtx.resume();
  }

  function baslatDongu() {
    if(oyunDongusu) clearInterval(oyunDongusu);
    oyunDongusu = setInterval(cizimYap, 1000 / hiz);
  }

  function rastgeleYem() {
    let renkler = ['#ff0055'];
    if (skor >= 5 && skor < 15) renkler = ['#ff0055', '#ffa500'];
    else if (skor >= 15) renkler = ['#ff0055', '#ffa500', '#00ffff', '#ff00ff', '#ffff00', '#ffffff'];
    
    yem = { 
      x: Math.floor(Math.random() * karoSayisi), 
      y: Math.floor(Math.random() * karoSayisi),
      renk: renkler[Math.floor(Math.random() * renkler.length)]
    };

    if (!powerUp && Math.random() > 0.85) {
      powerUp = { x: Math.floor(Math.random() * karoSayisi), y: Math.floor(Math.random() * karoSayisi) };
    }
  }

  function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(rotationAngle);
    let rot = Math.PI / 2 * 3; let x = 0; let y = 0; let step = Math.PI / spikes;
    ctx.beginPath(); ctx.moveTo(0, -outerRadius);
    for (let i = 0; i < spikes; i++) {
      x = Math.cos(rot) * outerRadius; y = Math.sin(rot) * outerRadius;
      ctx.lineTo(x, y); rot += step;
      x = Math.cos(rot) * innerRadius; y = Math.sin(rot) * innerRadius;
      ctx.lineTo(x, y); rot += step;
    }
    ctx.closePath();
    ctx.fillStyle = "#ff00ff";
    ctx.shadowBlur = 20; ctx.shadowColor = "#ff00ff";
    ctx.fill();
    ctx.restore();
    rotationAngle += 0.1;
  }

  function cizimYap() {
    const kafa = {x: yilan[0].x + dx, y: yilan[0].y + dy};

    if (kafa.x < 0) kafa.x = karoSayisi - 1; if (kafa.x >= karoSayisi) kafa.x = 0;
    if (kafa.y < 0) kafa.y = karoSayisi - 1; if (kafa.y >= karoSayisi) kafa.y = 0;

    if (!hayaletModu) {
      for (let i = 0; i < yilan.length - 1; i++) {
        if (kafa.x === yilan[i].x && kafa.y === yilan[i].y) return oyunBitti();
      }
      for (let e of engeller) {
        if (kafa.x === e.x && kafa.y === e.y) return oyunBitti();
      }
    }

    yilan.unshift(kafa);

    if (kafa.x === yem.x && kafa.y === yem.y) {
      skor++;
      document.getElementById('skor').innerText = skor;
      sesCal(440 + (skor * 5), 'sine', 0.1);
      rastgeleYem();
      hiz = 10 + (skor * 0.2); 
      baslatDongu();
      if (skor >= 20) {
        engeller.push({
          x: Math.floor(Math.random() * karoSayisi), 
          y: Math.floor(Math.random() * karoSayisi)
        });
      }
    } else {
      yilan.pop();
    }

    if (powerUp && kafa.x === powerUp.x && kafa.y === powerUp.y) {
      hayaletModu = true; hayaletSure = 100; powerUp = null;
      sesCal(880, 'square', 0.2);
    }

    if (hayaletSure > 0) {
      hayaletSure--;
      document.getElementById('hayaletBar').style.width = hayaletSure + "%";
      if (hayaletSure <= 0) hayaletModu = false;
    }

    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // --- ENGELLER (Koyu Gri ve Katı Görünüm) ---
    ctx.shadowBlur = 0;
    engeller.forEach(e => {
      ctx.fillStyle = '#333333'; // Ana gövde
      ctx.fillRect(e.x * kareBoyutu, e.y * kareBoyutu, kareBoyutu, kareBoyutu);
      ctx.strokeStyle = '#555555'; // Kenar detayı
      ctx.lineWidth = 2;
      ctx.strokeRect(e.x * kareBoyutu + 1, e.y * kareBoyutu + 1, kareBoyutu - 2, kareBoyutu - 2);
    });

    // Yılan
    yilan.forEach((p, i) => {
      if (hayaletModu) {
        ctx.fillStyle = i % 2 === 0 ? '#ffffff' : '#ff00ff';
      } else {
        ctx.fillStyle = i === 0 ? anaRenk : ikincilRenk;
      }
      ctx.fillRect(p.x * kareBoyutu, p.y * kareBoyutu, kareBoyutu - 1, kareBoyutu - 1);
    });

    // Yem
    ctx.fillStyle = yem.renk;
    ctx.shadowBlur = 15; ctx.shadowColor = yem.renk;
    ctx.beginPath();
    ctx.arc(yem.x * kareBoyutu + 10, yem.y * kareBoyutu + 10, 8, 0, Math.PI * 2);
    ctx.fill();

    // Yıldız
    if (powerUp) {
      drawStar(powerUp.x * kareBoyutu + 10, powerUp.y * kareBoyutu + 10, 5, 10, 5);
    }
  }

  function oyunBitti() {
    clearInterval(oyunDongusu);
    sesCal(150, 'sawtooth', 0.4);
    if (skor > rekor) localStorage.setItem('neonRekorV2', skor);
    document.getElementById('sonSkor').innerText = skor;
    document.getElementById('bitisEkrani').style.display = 'flex';
  }

  document.addEventListener('keydown', e => {
    if (e.keyCode === 37 && dx !== 1) { dx = -1; dy = 0; }
    else if (e.keyCode === 38 && dy !== 1) { dx = 0; dy = -1; }
    else if (e.keyCode === 39 && dx !== -1) { dx = 1; dy = 0; }
    else if (e.keyCode === 40 && dy !== -1) { dx = 0; dy = 1; }
  });
</script>
</body>
</html>
