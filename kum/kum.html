<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Dijital Kum Sanatı</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #111;
      color: white;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      touch-action: none; /* Mobilde kaydırmayı engelle */
    }

    #kanvas {
      display: block;
      cursor: crosshair;
    }

    #bilgi {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #444;
      pointer-events: none;
      user-select: none;
    }

    h1 { margin: 0; font-size: 1.2rem; color: #ff0055; }
    p { margin: 5px 0 0; font-size: 0.8rem; color: #ccc; }

    #kontrol {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    button {
      background: #333;
      color: white;
      border: 1px solid #555;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover { background: #555; }
    button:active { transform: scale(0.95); }

  </style>
</head>
<body>

<div id="bilgi">
  <h1>DİJİTAL KUM ⏳</h1>
  <p>Ekrana dokun ve sürükle.</p>
  <p>Renkler zamanla değişir.</p>
</div>

<canvas id="kanvas"></canvas>

<div id="kontrol">
  <button onclick="ekraniTemizle()">TEMİZLE</button>
  <button onclick="renkDegistir()">RENK MODU</button>
</div>

<script>
  const canvas = document.getElementById('kanvas');
  const ctx = canvas.getContext('2d');

  // Ayarlar
  const kumBoyutu = 5; // Her bir kum tanesinin boyutu
  let genislik, yukseklik;
  let sutunlar, satirlar;
  let izgara = []; // Kumların tutulduğu hafıza
  let hueValue = 0; // Renk değeri (Gökkuşağı efekti için)
  let cizimYapiyor = false;

  // Ekran boyutuna göre ayarla
  function ayarla() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    genislik = canvas.width;
    yukseklik = canvas.height;
    sutunlar = Math.floor(genislik / kumBoyutu);
    satirlar = Math.floor(yukseklik / kumBoyutu);

    // Izgarayı sıfırla
    izgara = new Array(sutunlar).fill(0).map(() => new Array(satirlar).fill(0));
  }

  window.addEventListener('resize', ayarla);
  ayarla();

  // --- FİZİK MOTORU (Cellular Automata) ---
  function dongu() {
    // 1. Çizimi Temizle (Arka Plan)
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, genislik, yukseklik);

    // 2. Tüm ızgarayı tara
    // Aşağıdan yukarıya tarıyoruz yoksa kumlar havada asılı kalır gibi görünür
    for (let i = 0; i < sutunlar; i++) {
      for (let j = satirlar - 1; j >= 0; j--) {
        let kumRengi = izgara[i][j];

        if (kumRengi > 0) {
          // Kumu çiz
          ctx.fillStyle = `hsl(${kumRengi}, 100%, 50%)`;
          ctx.fillRect(i * kumBoyutu, j * kumBoyutu, kumBoyutu, kumBoyutu);

          // --- FİZİK HESAPLAMASI ---
          // Eğer altı boşsa, düş
          let asagi = j + 1;
          if (asagi < satirlar) {
            if (izgara[i][asagi] === 0) {
              izgara[i][asagi] = kumRengi;
              izgara[i][j] = 0;
            }
            // Altı doluysa, sağa veya sola kaymaya çalış (Piramit efekti)
            else {
              let sol = i - 1;
              let sag = i + 1;
              let solBos = sol >= 0 && izgara[sol][asagi] === 0;
              let sagBos = sag < sutunlar && izgara[sag][asagi] === 0;

              if (solBos && sagBos) {
                // İki taraf da boşsa rastgele birine düş
                let rastgele = Math.random() < 0.5 ? sol : sag;
                izgara[rastgele][asagi] = kumRengi;
                izgara[i][j] = 0;
              } else if (solBos) {
                izgara[sol][asagi] = kumRengi;
                izgara[i][j] = 0;
              } else if (sagBos) {
                izgara[sag][asagi] = kumRengi;
                izgara[i][j] = 0;
              }
            }
          }
        }
      }
    }

    // Rengi yavaşça değiştir (Gökkuşağı akışı)
    hueValue += 0.5;
    if(hueValue > 360) hueValue = 0;

    requestAnimationFrame(dongu);
  }

  // --- KULLANICI ETKİLEŞİMİ ---

  function kumEkle(x, y) {
    // Koordinatları ızgaraya çevir
    let sutun = Math.floor(x / kumBoyutu);
    let satir = Math.floor(y / kumBoyutu);

    // Fırça boyutu (Tek seferde birden fazla kum dökülsün)
    let firca = 3;

    for(let i = -firca; i <= firca; i++) {
      for(let j = -firca; j <= firca; j++) {
        let s = sutun + i;
        let r = satir + j;

        // Sınır kontrolü ve rastgelelik (doğal görünüm için)
        if (s >= 0 && s < sutunlar && r >= 0 && r < satirlar) {
          if (Math.random() > 0.2 && izgara[s][r] === 0) {
            izgara[s][r] = hueValue; // O anki rengi ata
          }
        }
      }
    }
  }

  // Mouse Olayları
  canvas.addEventListener('mousedown', () => cizimYapiyor = true);
  canvas.addEventListener('mouseup', () => cizimYapiyor = false);
  canvas.addEventListener('mousemove', (e) => {
    if (cizimYapiyor) kumEkle(e.clientX, e.clientY);
  });

  // Dokunmatik Olayları (Mobil)
  canvas.addEventListener('touchstart', (e) => {
    cizimYapiyor = true;
    let touch = e.touches[0];
    kumEkle(touch.clientX, touch.clientY);
  }, {passive: false});

  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault(); // Sayfa kaymasını engelle
    if (cizimYapiyor) {
      let touch = e.touches[0];
      kumEkle(touch.clientX, touch.clientY);
    }
  }, {passive: false});

  canvas.addEventListener('touchend', () => cizimYapiyor = false);

  // Buton Fonksiyonları
  function ekraniTemizle() {
    izgara = new Array(sutunlar).fill(0).map(() => new Array(satirlar).fill(0));
  }

  function renkDegistir() {
    hueValue += 45; // Rengi ani değiştir
  }

  // Başlat
  dongu();

</script>
</body>
</html>